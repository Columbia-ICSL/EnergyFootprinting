<!DOCTYPE html>
<html>
<head>
	<link rel="stylesheet" type="text/css" href="dashboard/style.css">
	<script src="http://code.jquery.com/jquery-latest.min.js"></script>
	<script type="text/javascript" src="https://www.google.com/jsapi"></script>
	<script> google.load("visualization", "1", {packages:["corechart","timeline"]});</script>
	<script src="http://code.highcharts.com/highcharts.js"></script>
	<title>ePrints Dashboard</title>
</head>
<body>

<div class="banner">
	<img src="dashboard/Banner.png">
</div>

<div class="fullBlock">
	<div class="halfBlock">
		<div class="smallBlock">
			<div class="content">
				<img src="dashboard/flash.png">
			</div>
		</div><div class="smallBlock">
			<div class="content">
				<div id="piechart"></div>
				<script>
				
				var chart = null;
				var chartData = null;
				var options = {
						animation: {
							duration: 1000,
							easing: 'out',
							startup:true,
						},
						//chartArea: {height: '80%'},
			    		pieHole: 0.3,
			    		backgroundColor: 'transparent',
			    		colors: ['#FF7A71', '#BDE882', '#7B7FFF'],
			    		legend: {position: 'top', textStyle: {fontSize: 16, color: 'white'}, alignment: 'center'},
			    		pieSliceText: 'value'};


				function updateData() {
					$.get("/api/appSupport/buildingFootprint/",{},
				    	function(data,status){
				    	console.log(data,status);
				    	renderInput(data);
				    },'json').fail(function() {
					    alert('Error!'); // or whatever			    
					});
				}

				function renderInput(input) {
					if (chartData == null) {
						chartData = new google.visualization.DataTable();
						chartData.addColumn(['string', 'Resource Type']);
						chartData.addColumn(['number', 'W']);
						chartData.addRows([
			    		['HVAC', input.HVAC],
			    		['Lights', input.Light],
			    		['Plugs', input.Electrical]]);
					} else {
						chartData.setCell(0, 1, input.HVAC);
						chartData.setCell(1, 1, input.Light);
						chartData.setCell(2, 1, input.Electrical);

						// chartData.setCell(0, 1, input.HVAC);
						// chartData.setCell(1, 1, input.Light);
						// chartData.setCell(2, 1, input.Electrical);
					}
					if (chart == null) {
						chart = new google.visualization.PieChart(document.getElementById('piechart'));
					} else {
						chart.draw(chartData, options);
					}
				}

				// var data1 = {};
				// data1.HVAC = 1;
				// data1.Light = 1;
				// data1.Electrical = 1;
				// renderPie(data1);
			    function renderPie() {
			    	updateData();
			    	console.log("called Pie");
			    	setInterval(function() {
			    		updateData();
			    	}, 6000);
			    }


			    renderPie();
				</script>
			</div>
		</div><div class="mediumBlockBottom">
			<div class="content">
				<div id="columnChart"></div>
				<script>
				var colChart = null;
				var colChartData = null;
				var colOptions = {
					animation: {
						duration: 1000,
						easing: 'out',
						startup: true,
					},
					backgroundColor: 'transparent',
					hAxis: {
						title: 'Date',
						titleTextStyle: {
							color: 'white'
						},
						textStyle: {color: 'white'}
					},
					vAxis: {
						title: 'Daily Power Usage (Watt-Hours)',
						titleTextStyle: {
							color: 'white'
						},
						textStyle: {color: 'white'}
					}, legend: {position: 'none'}
				};

				function updateColData() {
					$.get("/api/appSupport/buildingFootprint/", {},
						function(data,status){
				    	console.log(data,status);
				    	renderCol(data);
				    },'json').fail(function() {
					    alert('Error!'); // or whatever			    
					});
				}


					
				function renderCol(input) {
					if (colChartData == null) {
						colChartData = new google.visualization.DataTable();
						colChartData.addColumn(['string', 'Date']);
						colChartData.addColumn(['number', 'W']);
						colChartData.addColumn({type: 'string', role: 'style'});
						colChartData.addRows([
							[input.historyStrings[0], input.history[0], 'stroke-color:#FDAB52; stroke-width:2; fill-color:#FDAB52; fill-opacity:0.5'],
							[input.historyStrings[1], input.history[1], 'stroke-color:#FDAB52; stroke-width:2; fill-color:#FDAB52; fill-opacity:0.5'],
							[input.historyStrings[2], input.history[2], 'stroke-color:#FDAB52; stroke-width:2; fill-color:#FDAB52; fill-opacity:0.5'],
							[input.historyStrings[3], input.history[3], 'stroke-color:#FDAB52; stroke-width:2; fill-color:#FDAB52; fill-opacity:0.5'],
							[input.historyStrings[4], input.history[4], 'stroke-color:#FDAB52; stroke-width:2; fill-color:#FDAB52; fill-opacity:0.5'],
							[input.historyStrings[5], input.history[5], 'stroke-color:#FDAB52; stroke-width:2; fill-color:#FDAB52; fill-opacity:0.5'],
							[input.historyStrings[6], input.energy, 'stroke-color:#FDAB52; stroke-width:2; fill-color:#FDAB52; fill-opacity:0.5']]);
					} else {
						colChartData.setCell(6, 1, input.energy);
					}
					if (colChart == null) {
						colChart = new google.visualization.ColumnChart(document.getElementById('columnChart'));
					} else {
						colChart.draw(colChartData, colOptions);
					}
				}

				function renderCol() {
			    	updateColData();
			    	console.log("called col");
			    	// setInterval(function() {
			    	// 	updateColData();
			    	// 	drawColChart();
			    	// }, 12000);
			    }
			    renderCol();

				</script>
			</div>
		</div><div class="mediumBlockBottom">
			<div class="content">
				<img src="dashboard/flash.png">
			</div>
		</div>
	</div><div class="halfBlock">
		<div class="mediumBlockTop">
			<div class="content">
				<div id="chart4" class="panel-body" style="width:100%;height:calc((100vh - 100vw/30 - 32px)/3);display:none;"></div>
				<script>
				Date.prototype.toInputValue = (function() {
				    var local = new Date(this);
				    local.setMinutes(this.getMinutes() - this.getTimezoneOffset());
				    return local.toJSON().slice(0,16);
				});
				function getUTCSeconds(LocalDateStr){
					var utcDate=new Date(LocalDateStr);
					utcDate.setMinutes(utcDate.getMinutes() + utcDate.getTimezoneOffset());
					return Math.floor(+utcDate/1000);
				}

				var ch4=document.getElementById('chart4');
				//ch1 is the chart, frm1 is the form
				var people;
				var rightNow = new Date();
				var hourAgo = new Date();
				hourAgo.setHours(0);
				hourAgo.setMinutes(0);
				hourAgo.setSeconds(0);
				hourAgo.setDate(hourAgo.getDate() - 1)

				hourAgo.toInputValue();
				console.log(hourAgo);
				console.log(rightNow);
			    $.get("/api/dataExtraction/BuildingFootprintDisaggregated/",{
			    		start:getUTCSeconds(hourAgo),
			    		end:getUTCSeconds(rightNow),
		    		},
			    	function(data,status){
			    	console.log(data,status);
			    	render4(data);
			    },'json').fail(function() {
				    alert('Error!'); // or whatever			    
				});
				  
				function render4(input){
				  	input=input.reverse();

			        var data = new google.visualization.DataTable();
			        data.addColumn('datetime', 'TIME'); // Implicit domain label col.
					data.addColumn('number', 'HVAC (W)');
			        data.addColumn('number', 'Lighting (W)');
			        data.addColumn('number', 'Electric (W)');

			        var lastR=false;
			        for(var i=0;i<input.length;i++){
			          var item=input[i];
			          //console.log('row',ret);
			          var date = new Date(item.timestamp*1000)
			          data.addRow([date, item.HVAC, item.Light, item.Electrical]);
			        };
					console.log(data);
			        

					var chart = new google.visualization.AreaChart(ch4);
					var titleString = 'Total Deployment Footprint By Resource Type';
			        var options = {
			        	legend:{textStyle: {fontSize: 12, color:'#FFFFFF'}},
			        	//chartArea:{left:200,top:200,width:845,height:210},
			        	//height: 600,
			        	//width: 1700,
			        	isStacked:true,
			        	tooltip: { isHtml: true},
			        	colors:['#FF7A71', '#BDE882', '#7B7FFF'],
			        	lineColors: ['#DF5A51', '#9DC862', '#5B5FDF'],
			        	hAxis: {
			        		gridlines: {
			        			color:'#0B0B0B'
			        		},
		          			textStyle: {
		          				fontSize:12,
		          				color:'#FFFFFF'
		          			}
		          		},
			        	vAxis: {
			        		gridlines: {
			        			color:'#0B0B0B'
			        		},
		          			//title: 'Deployment Energy Footprint (W)',
		              		//titleFontSize:25,
		          			textStyle: {
		          				fontSize:12,
		          				color:'#FFFFFF'
		          			},
		          			viewWindow: {
		          				min:21000
		          			},
		          		},

		          		backgroundColor: '#303030'

		        		
			          //width:800,
			          //height:500,
			          //annotations: {'*': {style: 'line'}}
			        };
			        $(ch4).show(0,function(){
			        	chart.draw(data, options);
			        	$(ch4).slideToggle(0).slideToggle(1000);	
			        });
			        function drawChart() {
						google.visualization.events.addListener(chart, 'ready',
							function() {

							});
						chart.draw(data, options);
					}
					setInterval(function () {
						console.log("Hello World");
					}, 5000);
				}
				</script>
			</div>
		</div><div class="largeBlock">
			<div class="content">
				<div id="chart2" class="panel-body" style="width:100%;height:calc((100vh - 100vw/30 - 32px)/3);display:none;"></div>
				<script>
					Date.prototype.toInputValue = (function() {
					    var local = new Date(this);
					    local.setMinutes(this.getMinutes() - this.getTimezoneOffset());
					    return local.toJSON().slice(0,16);
					});
					function getUTCSeconds(LocalDateStr){
						var utcDate=new Date(LocalDateStr);
						utcDate.setMinutes(utcDate.getMinutes() + utcDate.getTimezoneOffset());
						return Math.floor(+utcDate/1000);
					}
					var ch2=document.getElementById('chart2');
					var people;
					var rightNow = new Date();
					var hourAgo = new Date();
					hourAgo.setHours(0);
					hourAgo.setMinutes(0);
					hourAgo.setSeconds(0);
					hourAgo.setDate(hourAgo.getDate() - 1)
					hourAgo.toInputValue();
					console.log(hourAgo);
					console.log(rightNow);
				    $.get("/api/dataExtraction/PersonalConsumption/",{
				    		user:"",
				    		start:getUTCSeconds(hourAgo),
				    		end:getUTCSeconds(rightNow),
			    		},
				    	function(data,status){
					    	console.log(data,status);
					    	render2(data);
				    	},'json').fail(function() {
					    alert('Error!'); // or whatever			    
					});

					  
					function render2(input){
					  	input=input.reverse();

				        var data = new google.visualization.DataTable();
				        data.addColumn('datetime', 'TIME'); // Implicit domain label col.
				        //data.addColumn('number', 'WATTS');
				        data.addColumn('number', 'HVAC (W)');
				        data.addColumn({type:'string', role:'tooltip'});
				        data.addColumn('number', 'Lighting (W)');
				        data.addColumn('number', 'Electrical (W)');


				        var lastR=false;
				        for(var i=0;i<input.length;i++){
				        	var item=input[i];
				        	//console.log('row',ret);
				        	var date = new Date(item.timestamp*1000)
				        	var electricTemp = item.Electrical + 90;
				        	data.addRow([date, item.HVAC, "location: " + item.location, item.Light, electricTemp]);//item.value
				        };
						console.log(data);
				        
						var titleString = 'Personal Footprint For: Occupant A';
						var chart = new google.visualization.AreaChart(ch2);
				        var options = {
				        	legend:{textStyle: {fontSize: 12, color:'#FFFFFF'}},
//				        	chartArea:{left:200,top:200,width:868,height:140},
//				        	height: 600,
//				        	width: 1700,
				        	isStacked:true,
				        	tooltip: { isHtml: true},
				        	colors:['#FF7A71', '#BDE882', '#7B7FFF'],
				        	lineColors: ['#DF5A51', '#9DC862', '#5B5FDF'],
				        	hAxis: {
				        		//titleFontSize:25,
			          			//title: 'Time of Day',
			          			textStyle: {
			          				fontSize:12,
			          				color:'#FFFFFF'
			          			},
			          			gridlines: {
				        			color:'#0B0B0B'
				        		},
			          		},
				        	vAxis: {
				        		//titleFontSize:25,
			          			//title: 'Personal Energy Footprint (W)',
			          			textStyle: {
			          				fontSize:12,
			          				color:'#FFFFFF'
			          			},
			          			gridlines: {
				        			color:'#0B0B0B'
				        		},
			        		},
			          		backgroundColor: '#303030'
				          //width:800,
				          //height:500,
				          //annotations: {'*': {style: 'line'}}
				        };
				        $(ch2).show(0,function(){
				        	chart.draw(data, options);
				        	$(ch2).slideToggle(0).slideToggle(1000);	
				        });
					}
				</script>
			</div>
		</div>
	</div>
</div>



<script type="text/javascript">


</script>

</body>
</html>
